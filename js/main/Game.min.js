define(["World","CanvasEngine","MV","AppObject","Canvas"],function(d,e,c,b,a){var f=function(g){this.initialize(g)};f.prototype=new b;f.prototype.initialize=function(h){var g=this;g.canvasEngine=null;g.container=null;g.debugContainer=null;g.world=null;g.objectsLayer=null;g.quadLayer=null;g.drawLayer=null;g.running=false;g.readFrame=null;g.scalevar=1;g.showQuadTree=false;g.showAABBS=false;g.loopCallback=null;g.useQuadTree=true;g.debug=false;g.debuggerContainer=null;g.dt=1/30;g.set(h)};f.prototype.getDrawLayer=function(){var g=this;if(g.drawLayer==null){g.drawLayer=g.getCanvasEngine().createLayer({width:10000,height:10000},a)}return g.drawLayer};f.prototype.getQuadLayer=function(){var g=this;if(g.quadLayer==null){g.quadLayer=g.getCanvasEngine().createLayer({width:10000,height:10000},a)}return g.quadLayer};f.prototype.getObjectsLayer=function(){var g=this;if(g.objectsLayer==null){g.objectsLayer=g.getCanvasEngine().createLayer({width:10000,height:10000},a)}return g.objectsLayer};f.prototype.getWorld=function(){var g=this;if(g.world==null){g.world=new d({debug:g.debug})}return g.world};f.prototype.getCanvasEngine=function(){var g=this;if(g.canvasEngine==null){g.canvasEngine=e.createEngine({width:"100%",height:600,container:g.container,scalable:true})}return g.canvasEngine};f.prototype.refreshDraw=function(){var g=this;g.drawWorld();if(g.showQuadTree){g.drawQuadTree()}if(g.showAABBS){g.drawAABBS()}};f.prototype.setShowQuadTree=function(g){var h=this;h.showQuadTree=g;h.getQuadLayer().clear();if(!h.running&&g){h.drawQuadTree()}};f.prototype.setShowAABBS=function(g){var h=this;h.showAABBS=g;h.refreshDraw()};f.prototype.scale=function(i){var g=this;var h=g.scalevar+i;if(h<=f.MAX_SCALE&&h>=f.MIN_SCALE){g.getCanvasEngine().set({scale:h})}};f.prototype.add=function(g){var h=this;h.getWorld().add(g);if(h.debuggerContainer!=null){$(h.debuggerContainer).append(g.getDebugElement().element)}if(!h.running){h.refreshDraw()}};f.prototype.remove=function(g){var h=this;h.getWorld().remove(g,!h.running);if(!h.running){h.refreshDraw()}};f.prototype.removeAll=function(h){var g=this;var i=g.getWorld();h.forEach(function(j){i.remove(j,!g.running)});if(!g.running){g.refreshDraw()}};f.prototype.drawWorld=function(){var g=this;g.getObjectsLayer().drawWorld(g.world)};f.prototype.drawAABBS=function(){var g=this;var h=g.getObjectsLayer();g.world.bodies.forEach(function(i){h.drawAABB(i.getAABB())})};f.prototype.drawQuadTree=function(){var g=this;g.getQuadLayer().drawQuadTree(g.world.quadTree)};f.prototype.start=function(){var g=this;g.restart()};f.prototype.pause=function(){var g=this;if(g.running){g.running=false;clearInterval(g.readFrame)}return g};f.prototype.restart=function(){var g=this;if(!g.running){g.running=true;g.loop(g)}};f.prototype.loop=function(g){if(g.running){setTimeout(function(){requestAnimationFrame(function(){g.loop(g)});g.getWorld().step();g.refreshDraw();if(g.loopCallback!=null){g.loopCallback()}},g.dt*1000)}};f.prototype.getPosition=function(h){var g=this;return c.VdV(c.VpV(h,g.canvas.min),[g.scalevar,g.scalevar])};f.MAX_SCALE=20;f.MIN_SCALE=0.1;return f});