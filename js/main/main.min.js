$(document).ready(function(){function k(){e.clearScreen();e.drawShape(a.shape)}function g(){for(var a=b.getMouse(),d=0;d<b.world.bodies.length;d++){var e=b.world.bodies[d],h=e.getVerticesInWorldCoords(),g=MV.min(h,0),k=MV.min(h,1),l=MV.maxLevel(h,0),h=MV.maxLevel(h,1);if(a[0]>=g&&a[1]>=k&&a[0]<=l&&a[1]<=h)return e}return null}$("body").on("contextmenu","#game",function(a){return!1});var b=new Game,e=new Canvas("drawing");b.start();var l=[0,0];KeyReader.onkeydown(KeyReader.KEY_ENTER,function(){if("convex"==
    a.selected){if(!a.shape.isClockWise()){var c=a.shape.vertices.shift();a.shape.vertices.reverse();a.shape.vertices.unshift(c)}a.shape.updateCenter();a.shape.updateRelative();c=new Body(a.shape,Material.Gold,"true"==$("#tipo").val());b.world.addBody(c);a.shape=null;a.drawing=!1;a.drawPoint=null;a.auxpoint=null;e.clearScreen();b.running||b.canvas.drawWorld(b.world)}});KeyReader.onkeydown(KeyReader.KEY_ESC,function(){a.shape=null;a.drawing=!1;a.drawPoints=[];e.clearScreen()});KeyReader.onkeydown(KeyReader.KEY_PLUS,
    function(){null!=a.shape&&"regular"==a.selected&&(a.shape.sides++,a.shape.updateVertices(),k())});KeyReader.onkeydown(KeyReader.KEY_MINUS,function(){null!=a.shape&&"regular"==a.selected&&3<a.shape.sides&&(a.shape.sides--,a.shape.updateVertices(),k())});KeyReader.onkeydown(KeyReader.KEY_DEL,function(){b.world.removeBody(a.selectedBody);b.running||b.canvas.drawWorld(b.world)});b.reader.onmousedown(b.reader.RIGHT,function(){var a=b.canvas.center;$("#game").css("cursor","move");l=MV.VpV(b.reader.vertex,
    a)});b.reader.onmouseup(b.reader.RIGHT,function(){$("#game").css("cursor","default")});$("#game").mouseup(function(c){null!=a.mousejoint&&(b.world.removeJoint(a.mousejoint),b.world.mouseJoint=null)});$("#game").on("mousewheel",function(c){a.drawing||(0<c.deltaY&&20>b.canvas.scale?(b.canvas.scale+=.1,e.scale+=.1,b.quad.scale+=.1):.2<b.canvas.scale&&(b.canvas.scale-=.1,e.scale-=.1,b.quad.scale-=.1),b.running||b.canvas.drawWorld(b.world));"regular"==a.selected&&a.drawing&&(c=c.deltaY,0<c?a.shape.sides++:
    0>c&&3<a.shape.sides&&a.shape.sides--,a.shape.updateVertices(),k())});$("#game").mousemove(function(){if(b.reader.right){var a=MV.VmV(l,b.reader.vertex);b.canvas.move(a);e.move(a);b.quad.move(a);b.running||(b.quad.drawQuadTree(b.world.quadTree),b.canvas.drawWorld(b.world))}});$("#action").click(function(){b.running?b.pause():b.restart()});var a={itens:"quadrado regular circulo cursor eraser move convex chain".split(" "),selected:"cursor",drawing:!1,shape:null,selectedBody:null,auxpoint:null,mousejoint:null,
    distancejoint:null,joint:null,select:function(a){this.selected=a;$("#"+a).addClass("well well-sm");for(var b=0;b<this.itens.length;b++)this.itens[b]!=a&&$("#"+this.itens[b]).removeClass("well well-sm");this.drawing=!1;this.shape=null;e.clearScreen()}};$("#quadrado,#circulo,#regular,#cursor,#eraser,#move,#convex,#chain").click(function(){a.select($(this).attr("id"))});a.select("cursor");$("#preenchimento").change(function(){var c=document.getElementById("preenchimento").value;null!=a.shape?a.shape.color=
    new Color(c):null!=a.selectedBody&&(a.selectedBody.shape.color=new Color(c),b.running||b.canvas.drawWorld(b.world))});$("#tipo").change(function(){var b="true"==document.getElementById("tipo").value;null!=a.selectedBody&&a.selectedBody.setDinamic(b)});$("#game").click(function(){if(a.drawing)switch(a.selected){case "quadrado":a.drawing=!1;e.clearScreen();d=new Body(a.shape,Material.Iron,"true"==$("#tipo").val());b.world.addBody(d);a.drawPoint=null;b.running||b.canvas.drawWorld(b.world);break;case "convex":c=
    b.getMouse();a.shape.vertices.splice(a.shape.vertices.length-1,1);null!=a.auxpoint?(a.shape.vertices.push(a.auxpoint),a.auxpoint=null):a.shape.vertices.push(c);a.shape.vertices.push(a.drawPoint);break;case "regular":a.drawing=!1;e.clearScreen();d=new Body(a.shape,Material.Iron,"true"==$("#tipo").val());b.world.addBody(d);a.shape=null;a.drawPoint=null;b.running||b.canvas.drawWorld(b.world);break;case "chain":a.drawing=!1,d=g(),null!=d&&a.joint.bodyA!=d&&(c=b.getMouse(),a.joint.vertexB=[d.center[0]-
    c[0],d.center[1]-c[1]],a.joint.bodyB=d,b.world.addJoint(a.joint),a.joint=null,a.drawing=!0)}else{var c=b.getMouse();a.drawPoint=c;if("quadrado"==a.selected)a.shape=new Rect([0,0],10,10),a.shape.color=new Color(document.getElementById("preenchimento").value),a.drawing=!0;else if("convex"==a.selected)a.shape=new Polygon([0,0],0),a.shape.vertices.push([c[0],c[1]]),a.shape.vertices.push(a.drawPoint),a.shape.color=new Color(document.getElementById("preenchimento").value),a.drawing=!0;else if("regular"==
    a.selected)null==a.shape&&(a.shape=new Regular([c[0],c[1]],10),a.shape.color=new Color(document.getElementById("preenchimento").value)),a.drawing=!0;else if("eraser"==a.selected){var d=g();null!=d&&b.world.removeBody(d);b.running||b.canvas.drawWorld(b.world)}else if("cursor"==a.selected)d=g(),null!=d&&(null!=a.selectedBody&&(a.selectedBody.shape.border.lineDash=[]),d.shape.border.lineDash=[5,5],document.getElementById("preenchimento").value=d.shape.color.toHEX(),document.getElementById("tipo").value=
    d.dinamic,a.selectedBody=d,b.running||b.canvas.drawWorld(b.world));else if("move"==a.selected){if(d=g(),null!=d&&d.dinamic){c=new Shape(a.drawPoint);c.vertices[0]=[0,0];c.center=a.drawPoint;var f=new MouseBody(c);f.center=a.drawPoint;a.mousejoint=new Joint(f,0,d,0);b.world.addJoint(a.mousejoint)}}else"chain"==a.selected&&(f=g(),null!=f&&(c=b.getMouse(),a.joint=new Joint,a.joint.type="surface",a.joint.vertexA=[f.center[0]-c[0],f.center[1]-c[1]],a.joint.bodyA=f,a.drawing=!0))}});$("#game").mousemove(function(){var c=
    b.getMouse();if(a.drawing&&null!=a.shape)switch(e.clearScreen(),a.selected){case "quadrado":c=MV.VmV(c,a.drawPoint);a.shape.updateDimen(Math.abs(c[0]),Math.abs(c[1]));a.shape.center=[a.drawPoint[0]+c[0]/2,a.drawPoint[1]+c[1]/2];e.drawShape(a.shape);break;case "convex":var d=a.drawPoint[0],f=a.drawPoint[1];a.drawPoint[0]=c[0];a.drawPoint[1]=c[1];a.shape.isConvex()&&(a.drawPoint[0]=d,a.drawPoint[1]=f,a.auxpoint=[d,f]);e.drawShape(a.shape);break;case "regular":c=Math.abs(MV.distance(c,a.drawPoint));
    a.shape.setRadius(c);e.drawShape(a.shape);break;case "circulo":c=Math.abs(MV.distance(c,a.drawPoint)),a.shape.setRadius(c),e.drawShape(a.shape)}else if(null!=a.selected)switch(a.selected){case "move":null!=a.drawPoint&&(a.drawPoint[0]=c[0],a.drawPoint[1]=c[1])}});$("#play-btn").click(function(){b.restart()});$("#pause-btn").click(function(){b.pause()})});