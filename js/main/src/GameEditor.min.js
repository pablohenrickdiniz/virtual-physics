define(["Game","reactDom","react","ToolMenu","Rect","Math","Body","Material","Polygon","KeyReader","Regular","Color","FrictionPhysics","MV","Border","chart"],function(f,o,c,g,a,d,q,i,l,n,p,b,m,k,h,j){var e={game:null,tools:[{name:"cursor",icon:"fa fa-2x fa-hand-o-up"},{name:"move",icon:"fa fa-2x fa-arrows"},{name:"convex",icon:"fa fa-2x fa-pencil"},{name:"rect",icon:"fa fa-2x fa-square"},{name:"circle",icon:"fa fa-2x fa-circle"},{name:"regular",icon:"fa fa-2x fa-star"}],selectedTool:null,shape:null,drawing:false,color:"rgba(0,0,0,0)",dinamic:true,chart:null,selectedBodies:[],lastLoop:null,bodiesQtd:[0,50,100,150,200,250,300,350,400,450,500],times:[0,0,0,0,0,0,0,0,0,0,0],initialize:function(){var s=this;var r=s.getGame();r.start();s.initializeTools()},initializeTools:function(){var t=this;var s=t.getGame();var w=s.getCanvasEngine();var x=w.getMouseReader();var v=w.getKeyReader();var r=s.getDrawLayer();var u=s.getWorld();v.onSequence([n.Keys.KEY_ENTER],function(){console.log("keydown");if(t.selectedTool=="convex"&&t.drawing){var z=t.shape;if(z.vertices.length>=3&&!z.isConvex()){if(!z.isClockWise()){z.invertPath()}z.updateCenter();z.updateRelative();var y=new q({shape:z,material:i.Iron,dinamic:t.dinamic});s.add(y);t.drawing=false;t.shape=null;r.clear()}}});v.onSequence([n.Keys.KEY_UP],function(){if(t.selectedTool=="regular"&&t.drawing){t.shape.set({sides:t.shape.sides+1});r.clear().drawShape(t.shape)}});v.onSequence([n.Keys.KEY_DOWN],function(){if(t.selectedTool=="regular"&&t.drawing){t.shape.set({sides:t.shape.sides-1});r.clear().drawShape(t.shape)}});v.onSequence([n.Keys.KEY_DEL],function(){t.selectedBodies.forEach(function(y){u.remove(y)})});x.onmousemove(function(){var I=e;if(x.left&&I.selectedTool=="move"){var A=x.lastDown.left;var J=x.lastMove;var B=e.getGame().getCanvasEngine().scale;A=d.sdv(B,A);J=d.sdv(B,J);var C=d.vmv(J,A);var H=C.x/2;var D=C.h/2;var G=A.x+(C.x/2);var F=A.y+(C.y/2);var E=new a({width:d.abs(C.x),height:d.abs(C.y),center:[G,F],border:new h({lineDash:[5,5]})});r.clear().drawShape(E);I.selectedBodies.forEach(function(y){y.shape.border.setLineDash([])});var z=e.findSelectedBodies(E);z.forEach(function(y){y.shape.border.setLineDash([5,5])});I.selectedBodies=z}});x.onmouseup(1,function(){if(t.selectedTool=="move"){r.clear()}});x.onmousedown(1,function(){switch(t.selectedTool){case"rect":t.executeRectTool(this.lastDown.left);break;case"convex":t.executePolygonTool(this.lastDown.left);break;case"regular":t.executeRegularTool(this.lastDown.left);break}if(t.drawing){r.clear().drawShape(t.shape)}else{r.clear();t.shape=null}});x.onmousemove(function(){var z=this;if(t.drawing){var A=z.lastDown.left;var y=z.lastMove;switch(t.selectedTool){case"rect":t.executeRectMove(A,y);break;case"convex":t.executePolygonMove(y);break;case"regular":t.executeRegularMove(A,y);break}r.clear().drawShape(t.shape)}});o.render(<ToolMenu items={t.tools} onItemCheck={t.onToolSelect}/>,document.getElementById("tool-menu"));$("#color").change(function(){t.color=$(this).val();if(t.shape!=null){t.shape.set({color:t.color});r.clear().drawShape(t.shape)}});$("#friccao").change(function(){e.getGame().getWorld().setFriction($(this).val())});$("#gravidade").change(function(){e.getGame().getWorld().setGravity($(this).val())});$("#dinamico").change(function(){t.dinamic=$(this).is(":checked")});$("#show-quadtree").change(function(){e.getGame().setShowQuadTree($(this).is(":checked"))});$("#show-aabb").change(function(){e.getGame().setShowAABBS($(this).is(":checked"))});$("#play-btn").click(function(){e.getGame().start()});$("#pause-btn").click(function(){e.getGame().pause()})},executeRectTool:function(t){var u=this;if(!u.drawing){u.drawing=true;var v=e.getGame().getCanvasEngine().scale;t=d.sdv(v,t);var s=[t.x,t.y];u.shape=new a({center:s,width:10,height:10,color:u.color})}else{u.drawing=false;var r=new q({shape:u.shape,material:i.Iron,dinamic:u.dinamic});u.getGame().add(r)}},executePolygonTool:function(r){var z=this;if(!z.drawing){z.drawing=true;var s=e.getGame().getCanvasEngine().scale;r=d.sdv(s,r);var y=[r.x,r.y];var x=[r.x,r.y];var w=[r.x,r.y+1];z.shape=new l({center:y,vertices:[x,w]})}else{var v=false;var t=z.shape.vertices;var y=[r.x-1,r.y-1];var x=[r.x-1,r.y+1];var w=[r.x+1,r.y-1];var u=[r.x+1,r.y+1];if(!z.shape.contains(y)){if(!l.isConvex(t.concat([y]))){v=z.shape.add(y)}}if(!v&&!z.shape.contains(x)){if(!l.isConvex(t.concat([x]))){v=z.shape.add(x)}}if(!v&&!z.shape.contains(w)){if(!l.isConvex(t.concat([w]))){v=z.shape.add(w)}}if(!v&&!z.shape.contains(u)){if(!l.isConvex(t.concat([u]))){v=z.shape.add(u)}}}},executeRegularTool:function(t){var s=this;if(!s.drawing){s.drawing=true;var u=e.getGame().getCanvasEngine().scale;t=d.sdv(u,t);s.shape=new p({center:[t.x,t.y]})}else{s.drawing=false;var r=new q({shape:s.shape,material:i.Iron,dinamic:s.dinamic});s.getGame().add(r)}},executeRegularMove:function(t,r){var s=this;var u=s.getGame().getCanvasEngine().scale;t=d.sdv(u,t);r=d.sdv(u,r);var v=d.distance(t,r);s.shape.set({radius:v})},executeRectMove:function(r,B){var s=e.getGame().getCanvasEngine().scale;r=d.sdv(s,r);B=d.sdv(s,B);var t=d.vmv(B,r);var A=this;var z=t.x/2;var u=t.h/2;var w=r.x+(t.x/2);var v=r.y+(t.y/2);A.shape.set({width:d.abs(t.x),height:d.abs(t.y),center:[w,v]})},executePolygonMove:function(s){var t=this;if(!t.shape.contains([s.x-1,s.y-1])){var u=t.shape.last();var r=u[0];var v=u[1];u[0]=s.x-1;u[1]=s.y-1;if(t.shape.isConvex()){u[0]=r;u[1]=v}}},getGame:function(){var r=this;if(r.game==null){r.game=new f({container:"#canvas-container",loopCallback:function(){var u=0;if(!r.lastCalledTime){r.lastCalledTime=Date.now()}else{var v=(new Date().getTime()-r.lastCalledTime)/1000;r.lastCalledTime=Date.now();u=1/v;var t=r.game.getWorld().bodies.length;var s=r.bodiesQtd.indexOf(t);if(s!=-1){r.times[s]=u;r.updateChart()}}}})}return r.game},onToolSelect:function(r){e.selectedTool=r},findSelectedBodies:function(u){var t=this;var s=[];var x;var r;var w=t.getGame().getWorld().bodies;var v=w.length;for(x=0;x<v;x++){r=w[x];if(m.AABBoverlap(m.getAABB2(u.getVerticesInWorldCoords()),r.getAABB())){s.push(r)}}return s},findSelectedBody:function(){var E=this;var D=e.getGame();var w=D.getCanvasEngine().scale;var C=D.getMouseReader().lastDown.left;C=d.sdv(w,C);var y;var z;var A=D.getWorld();var r=A.bodies;var v=r.length;var B;var x;var t;var s;var u;for(y=0;y<v;y++){z=r[y];B=z.shape;if(B.contains(C)){r.push(z)}}t=r.length;if(t>0){x=0;s=k.distance(r[0].center,C);for(y=1;y<t;y++){u=k.distance(r[y].center,C);if(u<s){s=u;x=y}}if(x!=-1){return r[x]}}return null},getPerformanceChart:function(){var s=this;if(s.chart==null){var r=$("#chart")[0].getContext("2d");console.log(r);var t=j.noConflict();s.chart=new t(r)}return s.chart},updateChart:function(){var r=this;r.getPerformanceChart().Line({labels:r.bodiesQtd,datasets:[{label:"My First dataset",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:r.times}]})}};return e});