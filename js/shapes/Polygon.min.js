define(["Shape","Color","Border","MV","lodash"],function(f,e,a,b,d){var c=function(h){var g=this;f.apply(g);g.vertices=[];g.min=[];g.max=[];g.AABB=null;g.bindProperties();g.set(h)};c.prototype=new f;c.prototype.add=function(h){var g=this;if(g.contains(h)){throw new TypeError("Esse vertice já existe no polígono")}else{if(!d.isNumber(h[0])||!d.isNumber(h[1])){throw new TypeError("O vertice deve ser um array de números")}else{g.vertices.push(h)}}return g};c.prototype.contains=function(l){var g=this;var m=false;var k=g.vertices.length;for(var j=0;j<k;j++){var h=g.vertices[j];if(h[0]==l[0]&&h[1]==l[1]){return true}}return false};c.prototype.last=function(){var g=this;if(g.vertices.length>0){return g.vertices[g.vertices.length-1]}return null};c.prototype.removeLast=function(){var g=this;if(g.vertices.length>0){g.vertices.length=g.vertices.length-1}};c.prototype.bindProperties=function(){var g=this;g.onChange("vertices",function(){g.updateCenter()})};c.prototype.isInside=function(m){var i=this;var h=i.getVerticesInWorldCoords();var j=h.length;var k=!1;var g;var l;g=-1;for(l=j-1;++g<j;l=g){(h[g][1]<=m[1]&&m[1]<h[l][1]||h[l][1]<=m[1]&&m[1]<h[g][1])&&m[0]<(h[l][0]-h[g][0])*(m[1]-h[g][1])/(h[l][1]-h[g][1])+h[g][0]&&(k=!k)}return k};c.prototype.getVerticesInWorldCoords=function(){var k=this;var j=[];var m=k.vertices;var n=m.length;var h=k.getCenter();for(var l=0;l<n;l++){j.push(b.rotate(b.VpV(h,m[l]),b.toDegree(k.theta),k.center))}return j};c.prototype.getCenter=function(){if(this.center==null||this.center==undefined){this.updateCenter()}return this.center};c.prototype.getRelativeVertices=function(){var j=this;var m=j.vertices;var l=m.length;var k;var h=[];var n=j.center;for(k=0;k<l;k++){h.push([-(n[0]-m[k][0]),-(n[1]-m[k][1])])}return h};c.prototype.rotate=function(l,h){var g=this;if(h==undefined){h=g.center}else{g.center=b.rotate(g.center,l,h)}var k=g.vertices.length;var j;for(j=0;j<k;j++){g.vertices[j]=b.rotate(g.vertices[j],l,h)}};c.prototype.updateCenter=function(){var g=this;g.center=c.centroid(g.vertices);g.area=c.area(g.vertices)};c.prototype.moi2=function(l){var p=this;var k=0;var j=0;var m;var i;var o;var g;var q=p.vertices.length;var h;for(h=0;h<q;h++){m=h+1==q?0:h+1;i=p.vertices[h];o=p.vertices[m];g=b.norm(b.VxV(i,o));k+=g*b.dot(o,o)+b.dot(o,i)+b.dot(i,i);j+=g}return(l/6)*(k/j)};c.prototype.moi=function(q){var w=this;var n=w.center;var p=0;var m;var x=w.vertices.length;var t;var u;var r;var s;var l;var k;var o;var v;var g;var j;for(m=0;m<x;m++){t=m+1==x?0:m+1;u=w.vertices[m];r=w.vertices[t];s=b.distance(u,r);l=b.distance(r,n);k=b.distance(u,n);o=2*(l/k);v=0;if(l<k){v=Math.sqrt(Math.pow(l,2)-Math.pow(o,2))}else{v=Math.sqrt(Math.pow(k,2)-Math.pow(o,2))}g=(Math.pow(o,3)*s-Math.pow(s,2)*o*v+s*o*Math.pow(v,2)+s*Math.pow(o,3))/36;j=(s*o*q)/w.area;p+=g+j*Math.pow(b.distance(n,n),2)}return p};c.prototype.updateRelative=function(){var h=this;h.vertices=h.vertices.reverse();var g=h.center[0],m=h.center[1],k,j=h.vertices.length,l;for(k=0;k<j;k++){l=h.vertices[k];l[0]=(g-l[0])*-1;l[1]=(m-l[1])*-1}h.updateMinAndMax()};c.prototype.updateMinAndMax=function(){var h=this;var n=[h.vertices[0][0],h.vertices[0][1]];var g=[h.vertices[0][0],h.vertices[0][1]];var m=h.vertices.length,l,k;for(l=1;l<m;l++){for(k=0;k<=1;k++){if(h.vertices[l][k]<n[k]){n[k]=h.vertices[l][k]}else{if(h.vertices[l][0]>g[k]){g[k]=h.vertices[l][k]}}}}h.min=n;h.max=g};c.prototype.invertPath=function(){var g=this;var h=g.vertices.shift();g.vertices.reverse();g.vertices.unshift(h)};c.prototype.isClockWise=function(){var g=this;var n=0,l,k=g.vertices.length,h,o,m;for(l=0;l<k;l++){h=l+1==k?0:l+1;o=g.vertices[l];m=g.vertices[h];n+=((m[0]-o[0])*(m[1]+o[1]))}return n<0};c.prototype.sumAngles=function(){return c.sumAngles(this.vertices)};c.prototype.isConvex=function(){return c.isConvex(this.vertices)};c.centroid=function(l){var r=this;var g=[0,0];var q=0;var s=l.length;var p;var n;var j;var o;var h;var k;for(k=0;k<s;k++){p=k+1==s?0:k+1;o=l[k];n=l[p];j=o[0]*n[1]-n[0]*o[1];g[0]+=(o[0]+n[0])*j;g[1]+=(o[1]+n[1])*j;q+=j}q*=0.5;h=1/(6*q);g[0]*=h;g[1]*=h;return g};c.area=function(k){var p=0;var q=k.length;var n;var l;var h;var o;var g;var j;for(j=0;j<q;j++){n=j+1==q?0:j+1;o=k[j];l=k[n];h=o[0]*l[1]-l[0]*o[1];p+=h}p*=0.5;return p};c.sumAngles=function(n){var m=0;var l;var t=n.length;var h;var g;var p;var q;var o;var s;var r;if(n.length>=3){for(l=0;l<t;l++){h=l+1;h=h>=t?0:h;g=h+1;g=g>=t?0:g;q=n[l];p=n[h];o=n[g];s=b.VmV(p,q);r=b.VmV(o,p);m+=b.getDegree(s,r)}}return m};c.isConvex=function(g){return c.sumAngles(g)>360};return c});