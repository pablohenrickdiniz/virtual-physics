define(["Shape","Color","Border","MV"],function(e,d,a,b){var c=function(g){var f=this;e.apply(f);f.vertices=[];f.min=[];f.max=[];f.AABB=null;f.bindProperties();f.set(g)};c.prototype=new e;c.prototype.add=function(g){var f=this;if(!f.contains(g)){f.vertices.push(g);return true}return false};c.prototype.contains=function(k){var f=this;var l=false;var j=f.vertices.length;for(var h=0;h<j;h++){var g=f.vertices[h];if(g[0]==k[0]&&g[1]==k[1]){return true}}return false};c.prototype.last=function(){var f=this;if(f.vertices.length>0){return f.vertices[f.vertices.length-1]}return null};c.prototype.removeLast=function(){var f=this;if(f.vertices.length>0){f.vertices.length=f.vertices.length-1}};c.prototype.bindProperties=function(){var f=this;f.onChange("vertices",function(){f.updateCenter()})};c.prototype.isInside=function(m){var i=this;var h=i.getVerticesInWorldCoords();var j=h.length;var k=!1;var g;var l;g=-1;for(l=j-1;++g<j;l=g){(h[g][1]<=m[1]&&m[1]<h[l][1]||h[l][1]<=m[1]&&m[1]<h[g][1])&&m[0]<(h[l][0]-h[g][0])*(m[1]-h[g][1])/(h[l][1]-h[g][1])+h[g][0]&&(k=!k)}return k};c.prototype.getVerticesInWorldCoords=function(){var k=this;var j=[];var m=k.vertices;var n=m.length;var h=k.getCenter();for(var l=0;l<n;l++){j.push(b.rotate(b.VpV(h,m[l]),b.toDegree(k.theta),k.center))}return j};c.prototype.getCenter=function(){if(this.center==null||this.center==undefined){this.updateCenter()}return this.center};c.prototype.getRelativeVertices=function(){var h=this;var l=h.vertices;var k=l.length;var j;var f=[];var m=h.center;for(j=0;j<k;j++){f.push([-(m[0]-l[j][0]),-(m[1]-l[j][1])])}return f};c.prototype.rotate=function(k,g){var f=this;if(g==undefined){g=f.center}else{f.center=b.rotate(f.center,k,g)}var j=f.vertices.length;var h;for(h=0;h<j;h++){f.vertices[h]=b.rotate(f.vertices[h],k,g)}};c.prototype.updateCenter=function(){var f=this;f.center=c.centroid(f.vertices);f.area=c.area(f.vertices)};c.prototype.moi2=function(k){var o=this;var j=0;var i=0;var l;var h;var m;var f;var p=o.vertices.length;var g;for(g=0;g<p;g++){l=g+1==p?0:g+1;h=o.vertices[g];m=o.vertices[l];f=b.norm(b.VxV(h,m));j+=f*b.dot(m,m)+b.dot(m,h)+b.dot(h,h);i+=f}return(k/6)*(j/i)};c.prototype.moi=function(p){var v=this;var m=v.center;var o=0;var l;var w=v.vertices.length;var s;var t;var q;var r;var k;var j;var n;var u;var f;var g;for(l=0;l<w;l++){s=l+1==w?0:l+1;t=v.vertices[l];q=v.vertices[s];r=b.distance(t,q);k=b.distance(q,m);j=b.distance(t,m);n=2*(k/j);u=0;if(k<j){u=Math.sqrt(Math.pow(k,2)-Math.pow(n,2))}else{u=Math.sqrt(Math.pow(j,2)-Math.pow(n,2))}f=(Math.pow(n,3)*r-Math.pow(r,2)*n*u+r*n*Math.pow(u,2)+r*Math.pow(n,3))/36;g=(r*n*p)/v.area;o+=f+g*Math.pow(b.distance(m,m),2)}return o};c.prototype.updateRelative=function(){var g=this;g.vertices=g.vertices.reverse();var f=g.center[0],l=g.center[1],j,h=g.vertices.length,k;for(j=0;j<h;j++){k=g.vertices[j];k[0]=(f-k[0])*-1;k[1]=(l-k[1])*-1}g.updateMinAndMax()};c.prototype.updateMinAndMax=function(){var g=this;var m=[g.vertices[0][0],g.vertices[0][1]];var f=[g.vertices[0][0],g.vertices[0][1]];var l=g.vertices.length,k,h;for(k=1;k<l;k++){for(h=0;h<=1;h++){if(g.vertices[k][h]<m[h]){m[h]=g.vertices[k][h]}else{if(g.vertices[k][0]>f[h]){f[h]=g.vertices[k][h]}}}}g.min=m;g.max=f};c.prototype.invertPath=function(){var f=this;var g=f.vertices.shift();f.vertices.reverse();f.vertices.unshift(g)};c.prototype.isClockWise=function(){var f=this;var m=0,k,h=f.vertices.length,g,n,l;for(k=0;k<h;k++){g=k+1==h?0:k+1;n=f.vertices[k];l=f.vertices[g];m+=((l[0]-n[0])*(l[1]+n[1]))}return m<0};c.prototype.sumAngles=function(){return c.sumAngles(this.vertices)};c.prototype.isConvex=function(){return c.isConvex(this.vertices)};c.centroid=function(k){var q=this;var f=[0,0];var p=0;var r=k.length;var o;var l;var h;var n;var g;var j;for(j=0;j<r;j++){o=j+1==r?0:j+1;n=k[j];l=k[o];h=n[0]*l[1]-l[0]*n[1];f[0]+=(n[0]+l[0])*h;f[1]+=(n[1]+l[1])*h;p+=h}p*=0.5;g=1/(6*p);f[0]*=g;f[1]*=g;return f};c.area=function(j){var o=0;var p=j.length;var l;var k;var g;var n;var f;var h;for(h=0;h<p;h++){l=h+1==p?0:h+1;n=j[h];k=j[l];g=n[0]*k[1]-k[0]*n[1];o+=g}o*=0.5;return o};c.sumAngles=function(m){var l=0;var h;var s=m.length;var g;var f;var o;var p;var n;var r;var q;if(m.length>=3){for(h=0;h<s;h++){g=h+1;g=g>=s?0:g;f=g+1;f=f>=s?0:f;p=m[h];o=m[g];n=m[f];r=b.VmV(o,p);q=b.VmV(n,o);l+=b.getDegree(r,q)}}return l};c.isConvex=function(f){return c.sumAngles(f)>360};return c});