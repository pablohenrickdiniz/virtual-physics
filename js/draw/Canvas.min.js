define(["MV","Body","Polygon","LinearGradient","RadialGradient","Color","CanvasLayer"],function(c,h,e,f,d,g,b){var a=function(k,j){var i=this;b.apply(i,[k,j]);i.center=[i.width/2,i.height/2];i.min=[0,0]};a.prototype=new b;a.prototype.drawShape=function(j){var i=this;if(j instanceof h){i.drawBody(j)}else{if(j instanceof e){i.drawPolygon(j)}}};a.prototype.drawAABB=function(k){var i=this;var j=i.getContext();j.fillStyle="transparent";j.strokeRect(k[0],k[1],k[2]-k[0],k[3]-k[1])};a.prototype.drawQuadTree=function(j,n){var k=this;if(n!=true){k.clear()}k.drawAABB(j.AABB);var m=j.nodes.length;var l;var o;for(l=0;l<m;l++){o=j.nodes[l];if(o!=undefined&&o.qtd>0){k.drawQuadTree(o,true)}}};a.prototype.drawWorld=function(n){var k=this;k.clear();var m=n.bodies.length,j=n.bodies,l;for(l=0;l<m;l++){k.drawShape(j[l])}};a.prototype.drawCircle=function(j){var i=this;i.drawArc(j)};a.prototype.drawArc=function(k){var i=this;i.fillShadow(k.shadow);i.fillShape(k);var j=i.getContext();j.beginPath();j.arc(k.center[0],k.center[1],k.radius,Math.PI*k.start/180,Math.PI*k.end/180);j.fill();i.fillBorder(k.border)};a.prototype.drawPolygon=function(p){var k=this;var j=p.center;var l=p.vertices;var o=l.length;var n;var m=k.getContext();m.save();m.translate(j[0],j[1]);m.rotate(p.theta);m.beginPath();m.moveTo(l[0][0],l[0][1]);for(n=1;n<o;n++){m.lineTo(l[n][0],l[n][1])}m.closePath();k.fillShape(p);m.fill();k.fillShadow(p.shadow);k.fillBorder(p.border);m.restore()};a.prototype.drawBody=function(k){var l=this;var q=k.shape;var j=k.center;var m=q.vertices;var p;var o=m.length;var n=l.getContext();n.save();n.translate(j[0],j[1]);n.rotate(q.theta);n.beginPath();n.moveTo(m[0][0],m[0][1]);for(p=1;p<o;p++){n.lineTo(m[p][0],m[p][1])}n.closePath();l.fillShape(q);n.fill();l.fillShadow(q.shadow);l.fillBorder(q.border);n.restore()};a.prototype.move=function(i){var j=this;var l=j.center[0]-i[0];var k=j.center[1]-i[1];j.center=i;j.min=[i[0]-(j.width/2),i[1]-(j.height/2)];j.getContext().translate(l,k)};a.prototype.fillGradient=function(k){var j=k.color;var y=null;var A=k.updateMinAndMax();var G=A.max[0]-A.min[0];var F=A.max[1]-A.min[1];var w=G/2;var l=F/2;var s=A.min[0]+(w);var o=A.min[1]+(l);var E=this;var p=E.getContext();if(j instanceof d){var C=j.r;s=j.cx;o=j.cy;var v=j.fx;var t=j.fy;var B=(s-w)+G*(s/100);var K=(o-l)+F*(o/100);var N=(s-w)+G*(v/100);var x=(o-l)+F*(t/100);var z=G*(C/100);y=p.createRadialGradient(N,x,0,B,K,z)}else{var J=j.px0;var n=j.py0;var I=j.px1;var m=j.py1;var M=(s-w)+G*(J/100);var u=(o-l)+F*(n/100);var L=(s-w)+G*(I/100);var q=(o-l)+F*(m/100);y=p.createLinearGradient(M,u,L,q)}var D=j.colorsStop.length;var H;for(H=0;H<D;H++){y.addColorStop(j.colorsStop[H][0]/100,E.fillColor(j.colorsStop[H][1]))}return y};a.prototype.fillColor=function(i){if(i instanceof g){return i.toRGBA()}return i};a.prototype.fillShadow=function(k){if(k!=null){var i=this;var j=i.getContext();j.save();j.shadowOffsetX=k.x;j.shadowOffsetY=k.y;j.shadowBlur=k.blur;j.shadowColor=i.fillColor(k.color);j.fill();j.restore()}};a.prototype.fillBorder=function(j){if(j!=null){var i=this;var k=i.getContext();k.setLineDash(j.lineDash);k.lineCap=j.lineCap;k.strokeStyle=i.fillColor(j.color);k.lineWidth=j.thickness;k.stroke()}};a.prototype.fillShape=function(k){var j=k.color;var i=this;var l=i.getContext();if(j instanceof f||j instanceof d){l.fillStyle=i.fillGradient(k)}else{if(j instanceof Image){l.fillStyle=j.getFillPattern(i.context)}else{l.fillStyle=i.fillColor(j)}}};a.prototype.drawImage=function(i){if(i instanceof Image){if(i.loaded){var q=this;var j=i.getElement();var p=i.width;var k=i.height;var n=i.sx;var m=i.sy;var o=i.x;var l=i.y;q.getContext().drawImage(j,n,m,p,k,o,l,p,k);return true}}};return a});