define(["Shape","Material","MV","FrictionPhysics","AppObject","DebugElement"],function(f,d,b,g,a,c){var e=function(i){var h=this;h.shape=new f();h.center=[0,0];h.dinamic=true;h.material=d.Iron;h.vLin=[0,0];h.vAng=0;h.forces=[];h.forcePoints=[];h.groups=["A"];h.AABB=null;h.vertsAbsolute=null;h.inLeaf=[];h.rotMatTheta=null;h.rotationMatrix=null;h.index=null;h.debugElement=null;h.getDebugElement();h.bindProperties();h.set(i);h.getRotationMatrix()};e.prototype=new a;e.prototype.bindProperties=function(){var h=this;h.onChange("shape",function(i){h.center=i.center;i.parent=h;h.update()});h.onChange("dinamic",function(i){h.update()});h.onChange("mass",function(i){h.mInv=i==0?0:1/i;h.moiInv=i==0?0:1/h.shape.moi(i);h.rotationMatrix=null});h.onChange("material",function(i){h.update()});h.beforeSet("center",function(j,i){if(isNaN(i[0])||isNaN(i[1])){throw new TypeError("Center cannot be NaN");return j}return i});h.beforeSet("vLin",function(i,j){if(isNaN(j[0])||isNaN(j[1])){throw new TypeError("Vlin cannot be NaN");return i}return j});h.beforeSet("vAng",function(i,j){if(isNaN(j)){throw new TypeError("vAng cannot be NaN");return i}return j})};e.prototype.addLeaf=function(h){var i=this;i.inLeaf.push(h)};e.prototype.update=function(){var h=this;h.mass=h.dinamic?h.material.density*h.shape.area*2:0;h.mInv=h.mass==0?0:1/h.mass;h.moiInv=h.mass==0?0:1/h.shape.moi(h.mass);h.forces=[];if(h.dinamic){h.forces.push([0,98.81*h.mass])}else{h.vLin=[0,0];h.vAng=0}h.rotationMatrix=null};e.prototype.addForce=function(i,j){var h=this;h.forces.push(i);h.forcePoints.push(j)};e.prototype.removeForce=function(i){var h=this;h.forces.splice(i,1);h.forcePoints.splice(i,1)};e.prototype.getRotationMatrix=function(){var h=this;var i=h.shape.theta;if(i!==h.rotMatTheta||h.rotationMatrix==null){h.rotationMatrix=[[Math.cos(i),-Math.sin(i)],[Math.sin(i),Math.cos(i)]];h.rotMatTheta=i}return h.rotationMatrix};e.prototype.getAABB=function(){var h=this;if(h.AABB==null){h.AABB=g.getAABB2(h.getVerticesInWorldCoords())}return h.AABB};e.prototype.getVerticesInWorldCoords=function(){var k=this;if(k.vertsAbsolute==null){k.vertsAbsolute=[];var o=k.getRotationMatrix(),j=k.shape,l=j.vertices,n=l.length,h=k.center,m;for(m=0;m<n;m++){k.vertsAbsolute.push(b.VpV(h,b.MxV(o,l[m])))}}return k.vertsAbsolute};e.prototype.getDebugElement=function(){var h=this;if(h.debugElement==null){h.debugElement=new c(h);h.debugElement.debug("center").debug("vLin").debug("vAng")}return h.debugElement};e.prototype.destroy=function(){var h=this;h.getDebugElement().destroy()};return e});