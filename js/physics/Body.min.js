define(["Shape","Material","MV","FrictionPhysics","AppObject"],function(e,c,b,f,a){var d=function(h){var g=this;g.shape=new e();g.center=[0,0];g.dinamic=true;g.material=c.Iron;g.vLin=[0,0];g.vAng=0;g.forces=[];g.forcePoints=[];g.groups=["A"];g.AABB=null;g.vertsAbsolute=null;g.inLeaf=[];g.rotMatTheta=null;g.rotationMatrix=null;g.bindProperties();g.set(h);g.getRotationMatrix()};d.prototype=new a;d.prototype.bindProperties=function(){var g=this;g.onChange("shape",function(h){g.center=h.center;h.parent=g;g.update()});g.onChange("dinamic",function(h){g.update()});g.onChange("mass",function(h){g.mInv=h==0?0:1/h;g.moiInv=h==0?0:1/g.shape.moi(h);g.rotationMatrix=null});g.onChange("material",function(h){g.update()})};d.prototype.addLeaf=function(g){var h=this;h.inLeaf.push(g)};d.prototype.update=function(){var g=this;g.mass=g.dinamic?g.material.density*g.shape.area:0;g.mInv=g.mass==0?0:1/g.mass;g.moiInv=g.mass==0?0:1/g.shape.moi(g.mass);g.forces=[];if(g.dinamic){g.forces.push([0,98.81*g.mass])}else{g.vLin=[0,0];g.vAng=0}g.rotationMatrix=null};d.prototype.addForce=function(h,i){var g=this;g.forces.push(h);g.forcePoints.push(i)};d.prototype.removeForce=function(h){var g=this;g.forces.splice(h,1);g.forcePoints.splice(h,1)};d.prototype.getRotationMatrix=function(){var g=this;var h=g.shape.theta;if(h!==g.rotMatTheta||g.rotationMatrix==null){g.rotationMatrix=[[Math.cos(h),-Math.sin(h)],[Math.sin(h),Math.cos(h)]];g.rotMatTheta=h}return g.rotationMatrix};d.prototype.getAABB=function(){var g=this;if(g.AABB==null){g.AABB=f.getAABB2(g.getVerticesInWorldCoords())}return g.AABB};d.prototype.getVerticesInWorldCoords=function(){var j=this;if(j.vertsAbsolute==null){j.vertsAbsolute=[];var n=j.getRotationMatrix(),h=j.shape,k=h.vertices,m=k.length,g=j.center,l;for(l=0;l<m;l++){j.vertsAbsolute.push(b.VpV(g,b.MxV(n,k[l])))}}return j.vertsAbsolute};return d});