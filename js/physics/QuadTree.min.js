function QuadTree(h,k){this.AABB=h;this.l=k;this.bodies=[];this.AABBs=[];this.nodes=[];this.qtd=0;this.clear=function(){this.qtd=0;this.nodes=[];this.bodies=[];this.AABBs=[]};this.getAABBsGroups=function(a){a=void 0==a?[]:a;if(0<this.bodies.length&&1<this.qtd)a.push([this.bodies,this.AABBs]);else for(var b=this.nodes.length,c=0;c<b;c++)this.nodes[c].getAABBsGroups(a);return a};this.addBody=function(a,b){b=void 0==b?getAABB(a):b;if(5>=this.qtd||5==this.l)this.bodies.push(a),this.AABBs.push(b);else{void 0==
this.nodes[0]&&this.split();var c=this.bodies.length;if(0<c){for(var e=0;e<c;e++)this.insert(this.bodies[e],this.AABBs[e]);this.bodies=[];this.AABBs=[]}this.insert(a,b)}this.qtd++};this.removeBody=function(a){var b=!1;if(0<this.bodies.length&&0<this.qtd)a=this.bodies.indexOf(a),-1!=a&&(this.bodies.splice(a,1),this.AABBs.splice(a,1),b=!0);else{var c=0,e=this.nodes.length,d,f;for(f=0;f<e;f++)d=this.nodes[f],null!=d&&d.removeBody(a)&&(b=!0,0==d.qtd&&c++);4==c&&(this.nodes=[])}b&&this.qtd--;return b};
this.insert=function(a,b){var c,e=this.nodes.length,d;for(c=0;c<e;c++)d=this.nodes[c],AABBoverlap(d.AABB,b,0)&&d.addBody(a,b)};this.split=function(){var a=this.AABB[0],b=this.AABB[1],c=this.AABB[2],e=this.AABB[3],d=a+(c-a)/2,f=b+(e-b)/2,g=this.l+1;this.nodes[0]=new QuadTree([a,b,d,f],g);this.nodes[1]=new QuadTree([d,b,c,f],g);this.nodes[2]=new QuadTree([d,f,c,e],g);this.nodes[3]=new QuadTree([a,f,d,e],g)}};
