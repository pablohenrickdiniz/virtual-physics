define(["Body","FrictionPhysics"],function(a,c){var b=function(f,d){var e=this;e.AABB=f;e.l=d;e.bodies=[];e.AABBs=[];e.nodes=[];e.qtd=0};b.prototype.clear=function(){var d=this;d.qtd=0;d.bodies=[];d.AABBs=[];var f=d.nodes.length;var e;for(e=0;e<f;e++){if(d.nodes[e]!=undefined&&d.nodes[e].qtd>0){d.nodes[e].clear()}}};b.prototype.getAABBsGroups=function(g){var d=this;g=g==undefined?[]:g;if(d.bodies.length>0&&d.qtd>1){g.push([d.bodies,d.AABBs])}else{var f=d.nodes.length;var e;for(e=0;e<f;e++){d.nodes[e].getAABBsGroups(g)}}return g};b.prototype.add=function(d,h){var e=this;h=h==undefined?c.getAABB(d):h;if(e.qtd<=b.maxo||e.l==b.maxl){d.addLeaf(this);e.bodies.push(d);e.AABBs.push(h)}else{if(e.nodes[0]==undefined){e.split()}var g=e.bodies.length;if(g>0){var f;for(f=0;f<g;f++){e.bodies[f].inLeaf=[];e.insert(e.bodies[f],e.AABBs[f])}e.bodies=[];e.AABBs=[]}e.insert(d,h)}e.qtd++};b.prototype.remove=function(d){var e=this;var k=false;if(e.bodies.length>0&&e.qtd>0){var f=e.bodies.indexOf(d);if(f!=-1){e.bodies.splice(f,1);e.AABBs.splice(f,1);k=true}}else{var h=e.nodes.length;var j;var g;for(g=0;g<h;g++){j=e.nodes[g];if(j!=null&&j.remove(d)){k=true}}}if(k){e.qtd--}return k};b.prototype.insert=function(d,j){var e=this;var g;var f=e.nodes.length;var h;for(g=0;g<f;g++){h=e.nodes[g];if(c.AABBoverlap(h.AABB,j,0)){h.add(d,j)}}};b.prototype.split=function(){var o=this;var f=o.AABB[0];var m=o.AABB[1];var e=o.AABB[2];var k=o.AABB[3];var n=(e-f)/2;var j=(k-m)/2;var d=f+n;var i=m+j;var g=o.l+1;o.nodes[0]=new b([f,m,d,i],g);o.nodes[1]=new b([d,m,e,i],g);o.nodes[2]=new b([d,i,e,k],g);o.nodes[3]=new b([f,i,d,k],g)};b.maxl=5;b.maxo=3;return b});